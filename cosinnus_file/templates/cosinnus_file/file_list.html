{% extends "cosinnus_file/base.html" %}
{% load i18n static cosinnus_tags widget_tweaks thumbnail %}

{% block extrahead %}
    {{ block.super }}
    <script src="{% static 'js/vendor/jstree.min.js' %}"></script>
    <link href="{% static 'css/vendor/jstree/themes/default/style.min.css' %}" rel="stylesheet">
{% endblock extrahead %}


{% block page_title %}
{% trans "Files" %} {{ block.super }}
{% endblock page_title %}

{% block breadcrumb %}
        {{ block.super }}
        {% include "cosinnus_file/breadcrumb_file.html" with folder=current_folder breadcrumb_template="cosinnus_file/breadcrumb_file.html" %}
{% endblock %}

{% block leftnav %}
    {% include "cosinnus/leftnav_hierarchic_listview.html" %}
{% endblock leftnav %}

{% block content %}
	<!-- a box with semi transparent background -->
	<div class="content-box">
	
	    <div class="list-link-panel">
	       <a href="download/">
	           <i class="fa fa-download"></i>
	           {% trans "Download this folder" %}
	       </a>
	    </div>
	
	    {% include 'cosinnus/common/filter_controls.html' %}
		
		{% if user|can_create_objects_in:group %}
			{% comment %} Removed old upload button for now  
			
		    {% with obj_form=form.forms.obj %}
		    <form action="" enctype="multipart/form-data" method="post" class="form-horizontal">{% csrf_token %}
			    {{ obj_form.non_field_errors }}
				<div type="button" class="btn btn-default w100 large-space">
	                 <ul class="media-list">
	                     <li class="media">
	                         <a class="pull-left" href="#">
	                             <i class="fa fa-plus"></i>
	                         </a>
	                         <div class="media-body media-body-form-control">
	                             {{ obj_form.file.errors }}
	                             {% captureas placeholder %}{% trans "Upload a file or document." %}{% endcaptureas %}
	                             {% render_field obj_form.file class+="form-control next-button-is-for-sending" placeholder=placeholder id="fileToUpload" %}
	                         </div>
	                     </li>
	                 </ul>
	             </div>
	            <button type="submit" class="btn btn-emphasized large-space" style="display: none;">
	                <ul class="media-list">
	                    <li class="media">
	                        <a class="pull-left" href="#">
	                            <i class="fa fa-floppy-o"></i>
	                        </a>
	                        <div class="media-body">
	                            {% trans "Save" %}
	                        </div>
	                    </li>
	                </ul>
	            </button>
		    </form>
		    {% endwith %}
			{% endcomment %}
		    
		    <form action="" enctype="multipart/form-data" method="post" class="form-horizontal">{% csrf_token %}
		    	{% with cur_folder=current_folder.id %}
		    	{% with '{"on_success": "render_object", "direct_upload": "1", "target_folder": "'|addstr:cur_folder|addstr:'"}' as file_form_data %}
		    		{% include 'cosinnus/attached/file_upload_button.html' with form_data=file_form_data style="large" %}
		    	{% endwith %}
		    	{% endwith %}
		    </form>
		{% endif %}
		
		<div id="object_list_anchor"></div>
	    
	    {% for file in objects %}
			{% include 'cosinnus_file/single_file_detailed.html' with file=file %}
	    {% empty %}
	        <!-- {% trans "No files have been uploaded yet." %} -->
            {% include 'cosinnus/common/empty_button.html' with message="No files have been uploaded yet." %}
	    {% endfor %}
	
	</div><!-- content-box -->
	
    <script type="text/javascript">
        var cosinnus_move_element_object_url = "{% group_url 'cosinnus:file:move-element' group=group %}";
    </script>
    {% include 'cosinnus/hierarchy/move_element_modal.html' %}
    
{% endblock content %}
